public class GuestReviewProcessor {
     @InvocableMethod(label='Process Guest Reviews' description='Processes guest experience reviews and adds contact to related campaigns')
    public static List<GuestReviewResponse> processReviews(List<GuestReviewRequest> requests) {
        List<GuestReviewResponse> responses = new List<GuestReviewResponse>();
		List<Guest_Review__c> reviewsList = new List<Guest_Review__c>();
        for (GuestReviewRequest request : requests) {
                Guest_Review__c experienceRecord = new Guest_Review__c();
                experienceRecord.Contact__c = request.contact.Id;
                experienceRecord.Experience__c = request.experience.Id;
                experienceRecord.Rating__c  = request.rating;
                experienceRecord.Comments__c  = request.review;
            	reviewsList.add(experienceRecord);
        }
            try{
               Database.SaveResult[] results = Database.insert(reviewsList,false);
                for(Integer i = 0; i<requests.size();i++){
                    GuestReviewResponse response = new GuestReviewResponse();
                    if(results[i].isSuccess()){
                        response.message = 'Guest review successfully processed';
                    }
                    else {
                        response.message = 'Failed to process';
                    }
                     responses.add(response);
                }
               
                
            }
            catch(Exception ex){
                
            }
        return responses;
        }

    public class GuestReviewRequest {
        @InvocableVariable(required=true label='Contact' description='The contact who submitted the review')
        public Contact contact;

        @InvocableVariable(required=true label='Experience' description='The experience associated with the review')
        public Experience__c experience;

        @InvocableVariable(required=true label='Review' description='The textual review provided by the guest')
        public String review;

        @InvocableVariable(required=true label='Rating' description='The rating given by the guest')
        public String rating;
    }
    
    public class GuestReviewResponse {
        @InvocableVariable(label='Status' description='Status of the review submission process')
        public String message;
    }
}
